// Copyright 2023-2024 DreamWorks Animation LLC
// SPDX-License-Identifier: Apache-2.0

//
//
#include "ReSrgbC2F.h"

#include <math.h>

namespace scene_rdl2 {
namespace fb_util {

//
// Precomputed lookup table for conversion from sRGB 8bit value to linear float.
// This table is generated by ReSrgbC2FLUT::tblGen().
// Toshi (Sep/28/2020)
//
static const float sRGBc2f[256] = {
  /* tblid:  0 */ 0,
  /* tblid:  1 */ 0.000303527,
  /* tblid:  2 */ 0.000607054,
  /* tblid:  3 */ 0.000910581,
  /* tblid:  4 */ 0.00121411,
  /* tblid:  5 */ 0.00151763,
  /* tblid:  6 */ 0.00182116,
  /* tblid:  7 */ 0.00212469,
  /* tblid:  8 */ 0.00242822,
  /* tblid:  9 */ 0.00273174,
  /* tblid: 10 */ 0.00303527,
  /* tblid: 11 */ 0.00334654,
  /* tblid: 12 */ 0.00367651,
  /* tblid: 13 */ 0.00402472,
  /* tblid: 14 */ 0.00439144,
  /* tblid: 15 */ 0.00477695,
  /* tblid: 16 */ 0.00518152,
  /* tblid: 17 */ 0.00560539,
  /* tblid: 18 */ 0.00604883,
  /* tblid: 19 */ 0.00651209,
  /* tblid: 20 */ 0.00699541,
  /* tblid: 21 */ 0.00749903,
  /* tblid: 22 */ 0.00802319,
  /* tblid: 23 */ 0.00856812,
  /* tblid: 24 */ 0.00913406,
  /* tblid: 25 */ 0.00972122,
  /* tblid: 26 */ 0.0103298,
  /* tblid: 27 */ 0.0109601,
  /* tblid: 28 */ 0.0116122,
  /* tblid: 29 */ 0.0122865,
  /* tblid: 30 */ 0.012983,
  /* tblid: 31 */ 0.0137021,
  /* tblid: 32 */ 0.0144438,
  /* tblid: 33 */ 0.0152085,
  /* tblid: 34 */ 0.0159963,
  /* tblid: 35 */ 0.0168074,
  /* tblid: 36 */ 0.017642,
  /* tblid: 37 */ 0.0185002,
  /* tblid: 38 */ 0.0193824,
  /* tblid: 39 */ 0.0202886,
  /* tblid: 40 */ 0.021219,
  /* tblid: 41 */ 0.0221739,
  /* tblid: 42 */ 0.0231534,
  /* tblid: 43 */ 0.0241576,
  /* tblid: 44 */ 0.0251869,
  /* tblid: 45 */ 0.0262412,
  /* tblid: 46 */ 0.0273209,
  /* tblid: 47 */ 0.028426,
  /* tblid: 48 */ 0.0295568,
  /* tblid: 49 */ 0.0307134,
  /* tblid: 50 */ 0.031896,
  /* tblid: 51 */ 0.0331048,
  /* tblid: 52 */ 0.0343398,
  /* tblid: 53 */ 0.0356013,
  /* tblid: 54 */ 0.0368894,
  /* tblid: 55 */ 0.0382044,
  /* tblid: 56 */ 0.0395462,
  /* tblid: 57 */ 0.0409152,
  /* tblid: 58 */ 0.0423114,
  /* tblid: 59 */ 0.043735,
  /* tblid: 60 */ 0.0451862,
  /* tblid: 61 */ 0.0466651,
  /* tblid: 62 */ 0.0481718,
  /* tblid: 63 */ 0.0497066,
  /* tblid: 64 */ 0.0512695,
  /* tblid: 65 */ 0.0528607,
  /* tblid: 66 */ 0.0544803,
  /* tblid: 67 */ 0.0561285,
  /* tblid: 68 */ 0.0578054,
  /* tblid: 69 */ 0.0595112,
  /* tblid: 70 */ 0.0612461,
  /* tblid: 71 */ 0.06301,
  /* tblid: 72 */ 0.0648033,
  /* tblid: 73 */ 0.066626,
  /* tblid: 74 */ 0.0684782,
  /* tblid: 75 */ 0.0703601,
  /* tblid: 76 */ 0.0722719,
  /* tblid: 77 */ 0.0742136,
  /* tblid: 78 */ 0.0761854,
  /* tblid: 79 */ 0.0781874,
  /* tblid: 80 */ 0.0802198,
  /* tblid: 81 */ 0.0822827,
  /* tblid: 82 */ 0.0843762,
  /* tblid: 83 */ 0.0865005,
  /* tblid: 84 */ 0.0886556,
  /* tblid: 85 */ 0.0908417,
  /* tblid: 86 */ 0.093059,
  /* tblid: 87 */ 0.0953075,
  /* tblid: 88 */ 0.0975874,
  /* tblid: 89 */ 0.0998987,
  /* tblid: 90 */ 0.102242,
  /* tblid: 91 */ 0.104616,
  /* tblid: 92 */ 0.107023,
  /* tblid: 93 */ 0.109462,
  /* tblid: 94 */ 0.111932,
  /* tblid: 95 */ 0.114435,
  /* tblid: 96 */ 0.116971,
  /* tblid: 97 */ 0.119538,
  /* tblid: 98 */ 0.122139,
  /* tblid: 99 */ 0.124772,
  /* tblid:100 */ 0.127438,
  /* tblid:101 */ 0.130136,
  /* tblid:102 */ 0.132868,
  /* tblid:103 */ 0.135633,
  /* tblid:104 */ 0.138432,
  /* tblid:105 */ 0.141263,
  /* tblid:106 */ 0.144128,
  /* tblid:107 */ 0.147027,
  /* tblid:108 */ 0.14996,
  /* tblid:109 */ 0.152926,
  /* tblid:110 */ 0.155926,
  /* tblid:111 */ 0.158961,
  /* tblid:112 */ 0.162029,
  /* tblid:113 */ 0.165132,
  /* tblid:114 */ 0.168269,
  /* tblid:115 */ 0.171441,
  /* tblid:116 */ 0.174647,
  /* tblid:117 */ 0.177888,
  /* tblid:118 */ 0.181164,
  /* tblid:119 */ 0.184475,
  /* tblid:120 */ 0.187821,
  /* tblid:121 */ 0.191202,
  /* tblid:122 */ 0.194618,
  /* tblid:123 */ 0.198069,
  /* tblid:124 */ 0.201556,
  /* tblid:125 */ 0.205079,
  /* tblid:126 */ 0.208637,
  /* tblid:127 */ 0.212231,
  /* tblid:128 */ 0.215861,
  /* tblid:129 */ 0.219526,
  /* tblid:130 */ 0.223228,
  /* tblid:131 */ 0.226966,
  /* tblid:132 */ 0.23074,
  /* tblid:133 */ 0.234551,
  /* tblid:134 */ 0.238398,
  /* tblid:135 */ 0.242281,
  /* tblid:136 */ 0.246201,
  /* tblid:137 */ 0.250158,
  /* tblid:138 */ 0.254152,
  /* tblid:139 */ 0.258183,
  /* tblid:140 */ 0.262251,
  /* tblid:141 */ 0.266356,
  /* tblid:142 */ 0.270498,
  /* tblid:143 */ 0.274677,
  /* tblid:144 */ 0.278894,
  /* tblid:145 */ 0.283149,
  /* tblid:146 */ 0.287441,
  /* tblid:147 */ 0.291771,
  /* tblid:148 */ 0.296138,
  /* tblid:149 */ 0.300544,
  /* tblid:150 */ 0.304987,
  /* tblid:151 */ 0.309469,
  /* tblid:152 */ 0.313989,
  /* tblid:153 */ 0.318547,
  /* tblid:154 */ 0.323143,
  /* tblid:155 */ 0.327778,
  /* tblid:156 */ 0.332452,
  /* tblid:157 */ 0.337164,
  /* tblid:158 */ 0.341914,
  /* tblid:159 */ 0.346704,
  /* tblid:160 */ 0.351533,
  /* tblid:161 */ 0.3564,
  /* tblid:162 */ 0.361307,
  /* tblid:163 */ 0.366253,
  /* tblid:164 */ 0.371238,
  /* tblid:165 */ 0.376262,
  /* tblid:166 */ 0.381326,
  /* tblid:167 */ 0.38643,
  /* tblid:168 */ 0.391573,
  /* tblid:169 */ 0.396755,
  /* tblid:170 */ 0.401978,
  /* tblid:171 */ 0.40724,
  /* tblid:172 */ 0.412543,
  /* tblid:173 */ 0.417885,
  /* tblid:174 */ 0.423268,
  /* tblid:175 */ 0.428691,
  /* tblid:176 */ 0.434154,
  /* tblid:177 */ 0.439657,
  /* tblid:178 */ 0.445201,
  /* tblid:179 */ 0.450786,
  /* tblid:180 */ 0.456411,
  /* tblid:181 */ 0.462077,
  /* tblid:182 */ 0.467784,
  /* tblid:183 */ 0.473532,
  /* tblid:184 */ 0.47932,
  /* tblid:185 */ 0.48515,
  /* tblid:186 */ 0.491021,
  /* tblid:187 */ 0.496933,
  /* tblid:188 */ 0.502887,
  /* tblid:189 */ 0.508881,
  /* tblid:190 */ 0.514918,
  /* tblid:191 */ 0.520996,
  /* tblid:192 */ 0.527115,
  /* tblid:193 */ 0.533276,
  /* tblid:194 */ 0.53948,
  /* tblid:195 */ 0.545725,
  /* tblid:196 */ 0.552011,
  /* tblid:197 */ 0.55834,
  /* tblid:198 */ 0.564712,
  /* tblid:199 */ 0.571125,
  /* tblid:200 */ 0.577581,
  /* tblid:201 */ 0.584078,
  /* tblid:202 */ 0.590619,
  /* tblid:203 */ 0.597202,
  /* tblid:204 */ 0.603827,
  /* tblid:205 */ 0.610496,
  /* tblid:206 */ 0.617207,
  /* tblid:207 */ 0.62396,
  /* tblid:208 */ 0.630757,
  /* tblid:209 */ 0.637597,
  /* tblid:210 */ 0.64448,
  /* tblid:211 */ 0.651406,
  /* tblid:212 */ 0.658375,
  /* tblid:213 */ 0.665387,
  /* tblid:214 */ 0.672443,
  /* tblid:215 */ 0.679543,
  /* tblid:216 */ 0.686685,
  /* tblid:217 */ 0.693872,
  /* tblid:218 */ 0.701102,
  /* tblid:219 */ 0.708376,
  /* tblid:220 */ 0.715694,
  /* tblid:221 */ 0.723055,
  /* tblid:222 */ 0.730461,
  /* tblid:223 */ 0.737911,
  /* tblid:224 */ 0.745404,
  /* tblid:225 */ 0.752942,
  /* tblid:226 */ 0.760525,
  /* tblid:227 */ 0.768151,
  /* tblid:228 */ 0.775822,
  /* tblid:229 */ 0.783538,
  /* tblid:230 */ 0.791298,
  /* tblid:231 */ 0.799103,
  /* tblid:232 */ 0.806952,
  /* tblid:233 */ 0.814847,
  /* tblid:234 */ 0.822786,
  /* tblid:235 */ 0.83077,
  /* tblid:236 */ 0.838799,
  /* tblid:237 */ 0.846873,
  /* tblid:238 */ 0.854993,
  /* tblid:239 */ 0.863157,
  /* tblid:240 */ 0.871367,
  /* tblid:241 */ 0.879622,
  /* tblid:242 */ 0.887923,
  /* tblid:243 */ 0.896269,
  /* tblid:244 */ 0.904661,
  /* tblid:245 */ 0.913099,
  /* tblid:246 */ 0.921582,
  /* tblid:247 */ 0.930111,
  /* tblid:248 */ 0.938686,
  /* tblid:249 */ 0.947307,
  /* tblid:250 */ 0.955974,
  /* tblid:251 */ 0.964686,
  /* tblid:252 */ 0.973445,
  /* tblid:253 */ 0.982251,
  /* tblid:254 */ 0.991102,
  /* tblid:255 */ 1
};

// static function
float
ReSrgbC2F::rsRGB(const uint8_t uc)
//
// This is equivalent of following code (https://en.wikipedia.org/wiki/SRGB)
//
//    float f01 = uc / 255.0f;
//    return (f01 <= 0.04045f)? (f01 / 12.92f): powf((f01 + 0.055f) / 1.055f, 2.4f);
//
{
    return sRGBc2f[uc];
}

} // namespace fb_util
} // namespace scene_rdl2

